<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë°ì´íŠ¸ ìœ„í—˜ë„ ì˜ˆì¸¡</title>
</head>
<body>
  <h2>ë°ì´íŠ¸ ìœ„í—˜ë„ ì˜ˆì¸¡ê¸°</h2>

  <form id="predict-form">
    <label>ë‚ ì§œ:
      <input type="date" id="date" name="date">
    </label><br><br>

    <label>êµ¬:
      <select name="gu" id="gu">
        <option>ê°•ë‚¨êµ¬</option>
        <option>ê°•ë™êµ¬</option>
        <option>ê°•ë¶êµ¬</option>
        <option>ê°•ì„œêµ¬</option>
        <option>ê´€ì•…êµ¬</option>
        <option>ê´‘ì§„êµ¬</option>
        <option>êµ¬ë¡œêµ¬</option>
        <option>ê¸ˆì²œêµ¬</option>
        <option>ë…¸ì›êµ¬</option>
        <option>ë„ë´‰êµ¬</option>
        <option>ë™ì‘êµ¬</option>
        <option>ë§ˆí¬êµ¬</option>
        <option>ì„œëŒ€ë¬¸êµ¬</option>
        <option>ì„œì´ˆêµ¬</option>
        <option>ì„±ë™êµ¬</option>
        <option>ì†¡íŒŒêµ¬</option>
        <option>ì–‘ì²œêµ¬</option>
        <option>ìš©ì‚°êµ¬</option>
        <option>ì€í‰êµ¬</option>
        <option>ì¢…ë¡œêµ¬</option>
        <option>ì¤‘êµ¬</option>
        <option>ì¤‘ë‘êµ¬</option>
      </select>
    </label><br><br>

    <label>MBTI:
    <select name="mbti">
        <option>INFP</option>
        <option>INFJ</option>
        <option>ISFP</option>
        <option>ISFJ</option>
        <option>INTP</option>
        <option>INTJ</option>
        <option>ISTP</option>
        <option>ISTJ</option>

        <option>ENFP</option>
        <option>ENFJ</option>
        <option>ESFP</option>
        <option>ESFJ</option>
        <option>ENTP</option>
        <option>ENTJ</option>
        <option>ESTP</option>
        <option>ESTJ</option>
    </select>
    </label><br><br>

    <!-- ìˆ¨ê²¨ì§„ í•„ë“œ: ìë™ ê³„ì‚°ëœ ìš”ì¼ ë° ê¸°ë…ì¼ -->
    <input type="hidden" id="day" name="day">
    <input type="hidden" id="holiday" name="holiday">

    <button type="submit">ìœ„í—˜ë„ ì˜ˆì¸¡</button>
    <h3 id="result"></h3>
    <p id="weather-info"></p>
    <p id="day-message"></p> <!-- ìš”ì¼ ì•ˆë‚´ -->
    <label>ì§€í•˜ì²  ì—­ëª…:
    <input type="text" id="station" name="station" placeholder="ì—­ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" list="station-list" autocomplete="off">
    <datalist id="station-list"></datalist>
  </label><br><br>
  </form>
  <p id="subway-info"></p>
  <script>
    const holidayMap = {
      "02-14": "ë°œë Œíƒ€ì¸ë°ì´",
      "03-01": "ì‚¼ì¼ì ˆ",
      "05-05": "ì–´ë¦°ì´ë‚ ",
      "06-06": "í˜„ì¶©ì¼",
      "12-24": "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì´ë¸Œ",
      "12-25": "í¬ë¦¬ìŠ¤ë§ˆìŠ¤"
    };

    function getDayName(dateStr) {
      const days = ["ì¼ìš”ì¼", "ì›”ìš”ì¼", "í™”ìš”ì¼", "ìˆ˜ìš”ì¼", "ëª©ìš”ì¼", "ê¸ˆìš”ì¼", "í† ìš”ì¼"];
      const date = new Date(dateStr);
      return days[date.getDay()];
    }

    function getHoliday(dateStr) {
      const mmdd = dateStr.slice(5);
      return holidayMap[mmdd] || "ê¸°íƒ€";
    }

    document.getElementById("date").addEventListener("change", function () {
      const selectedDate = this.value;
      const dayName = getDayName(selectedDate);
      document.getElementById("day").value = dayName;
      document.getElementById("holiday").value = getHoliday(selectedDate);
    });

    document.getElementById("predict-form").addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData(this);
      const data = {
        date: formData.get("date"),         // ğŸ”¹ ë‚ ì§œ (ë‚ ì”¨ìš©)
        day: formData.get("day"),           // ìë™ ì„¤ì •ëœ ìš”ì¼
        gu: formData.get("gu"),
        mbti: formData.get("mbti"),
        holiday: formData.get("holiday"),    // ìë™ ì„¤ì •ëœ ê¸°ë…ì¼
      };

      const res = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      // âœ… ì´ë•Œ ìš”ì¼ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤€ë‹¤
      document.getElementById("day-message").innerText = `${data.day}ë‚  ì•½ì†ì´ ìˆìœ¼ì‹œêµ°ìš”!`;
      
    // ì˜ˆì¸¡ ë“±ê¸‰
    document.getElementById("result").innerText = result.grade
    ? `ì˜ˆì¸¡ ë“±ê¸‰: ${result.grade}`
    : `ì˜¤ë¥˜: ${result.error}`;

    // ğŸ”¹ ë‚ ì”¨ì™€ ì˜¨ë„ ì •ë³´ ì¶”ê°€ ì¶œë ¥
    if (result.weather && result.temperature !== undefined) {
    document.getElementById("weather-info").innerText =
        `ë‚ ì”¨: ${result.weather}, ì˜¨ë„: ${result.temperature}Â°C`;
    } else {
    document.getElementById("weather-info").innerText = "";
    }
    // ğŸ”¹ ì§€í•˜ì²  í˜¼ì¡ë„ ì •ë³´ ì¶œë ¥
    if (result.subway) {
      document.getElementById("subway-info").innerText = result.subway;
    } else {
      document.getElementById("subway-info").innerText = "";
    }
    });
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ì—ì„œ ì—­ëª… ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
    window.addEventListener("DOMContentLoaded", async () => {
      const res = await fetch("/stations");
      const result = await res.json();

      if (result.stations) {
        const datalist = document.getElementById("station-list");
        result.stations.forEach(station => {
          const option = document.createElement("option");
          option.value = station;
          datalist.appendChild(option);
        });
      }
    });
    document.getElementById("station").addEventListener("keydown", async function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        const station = this.value.trim();
        const day = document.getElementById("day").value;

        if (!station) return;

        const res = await fetch("/congestion", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ station, day })
        });

        const result = await res.json();
        document.getElementById("subway-info").innerText = result.message || "ì •ë³´ ì—†ìŒ";
      }
    });

  </script>
</body>
</html>
